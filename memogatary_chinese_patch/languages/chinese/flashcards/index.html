
<!doctype html>
<html lang="en">
<head>
  <title>Flashcard App · Chinese · Memogatary</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />`r`n    <link rel="icon" href="/favicon.png" type="image/png" />
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <script type="module" src="/assets/js/components/header.js"></script>
  <script type="module" src="/assets/js/components/footer.js"></script>
</head>
<body>
  <site-header></site-header>
  <main class="container prose">
    <h1>Flashcard App</h1>
    <!-- Flashcards (.xlsx) – pause, SinoViet 2nd row, EN break, centered -->
    <div id="flashcards-app"></div>
  </main>
  <site-footer></site-footer>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    #flashcards-app * { box-sizing: border-box; font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial; }
    .fc-wrap { max-width: 1200px; margin: 20px auto 40px; padding: 16px; }
    .fc-head { display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; margin-bottom:14px; }
    .fc-title { font-size: 24px; font-weight: 800; text-align:center; }
    .fc-select { padding: 8px 10px; border: 1px solid rgba(0,0,0,.15); border-radius: 10px; background:#fff; }

    .fc-card {
      position: relative; background:#fff; border-radius:20px; padding:34px;
      box-shadow:0 10px 28px rgba(0,0,0,.12);
      min-height: 420px; display:grid; place-items:center;
      transition: transform .2s ease;
    }
    .fc-card:hover { transform: translateY(-2px); }
    .fc-front, .fc-back { width:100%; text-align:center; }
    .fc-front .main { font-size: clamp(34px, 5vw, 46px); line-height:1.15; margin-bottom:8px; }
    .fc-front .sub  { font-size: 16px; opacity:.85; }

    .fc-back .meaning   { font-size: clamp(18px, 2.5vw, 22px); font-weight:700; margin-bottom:6px; }
    .fc-back .sinoviet  { font-size: clamp(16px, 2.2vw, 20px); margin-bottom:10px; }
    .fc-back .example   {
      font-size: clamp(14px, 2.2vw, 16.5px);
      opacity:.95; white-space: pre-line; text-align:center;
      max-height: 50vh; overflow:auto; overscroll-behavior:contain; padding: 0 6px;
    }

    .fc-meta { margin-top:10px; font-size:12px; opacity:.75; text-align:center; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
    .fc-timer { font-weight:700; }
    .fc-controls { display:flex; gap:10px; justify-content:center; margin-top:16px; flex-wrap:wrap; }
    .fc-btn {
      border:1px solid rgba(0,0,0,.12); background:#fff; padding:10px 14px; border-radius:12px; cursor:pointer;
      font-weight:600; transition: box-shadow .15s ease, transform .05s ease;
    }
    .fc-btn:active { transform: translateY(1px); }

    .fc-back { display:none; }
    .is-back .fc-front { display:none; }
    .is-back .fc-back  { display:block; }

    @media (max-width: 520px){
      .fc-card { padding:22px; min-height: 360px; }
    }
  </style>

  <script>
  (() => {
    // ===== CONFIG: set your Excel file URL here =====
    const XLSX_URL = "https://assets.zyrosite.com/YBg80qxkQqhQ2oxQ/allhskwebbuilder-mnlJ1ao8VDc8knZK.xlsx";

    // Exact header mapping
    const FIELDS = {
      level: "Level",
      number: "Number",
      phrase: "Phrase",
      pinyin: "Pinyin",
      example_simp: "Example",
      example_trad: "Ex-TW",
      example_pin:  "ExPinyin",
      example_vi:   "Ex-vi",
      example_en:   "Ex-En",
      example_en_ipa: "Ex-EnIPA",
      vn_def: "VnDef",
      sino_ex: "SinoEx",
      sino_viet: "SinoViet"
    };

    // ===== UI skeleton =====
    const root = document.getElementById("flashcards-app");
    root.innerHTML = `
      <div class="fc-wrap">
        <div class="fc-head">
          <div class="fc-title">HSK 2.0</div>
          <select class="fc-select" id="level-filter">
            <option value="__all__">All Levels</option>
          </select>
        </div>

        <div class="fc-card" id="fc-card">
          <div class="fc-front">
            <div class="main" id="fc-main">—</div>
            <div class="sub"  id="fc-sub">—</div>
          </div>

          <div class="fc-back">
            <div class="meaning"  id="fc-meaning">—</div>       <!-- VnDef -->
            <div class="sinoviet" id="fc-sinoviet"></div>       <!-- SinoViet (2nd row) -->
            <div class="example"  id="fc-example"></div>        <!-- Examples (Chinese + VI + SinoEx + EN + IPA) -->
          </div>
        </div>

        <div class="fc-controls">
          <button class="fc-btn" id="btn-prev">Previous</button>
          <button class="fc-btn" id="btn-random">Random</button>
          <button class="fc-btn" id="btn-flip">Flip</button>
          <button class="fc-btn" id="btn-next">Next</button>
          <button class="fc-btn" id="btn-pause">Pause</button>
        </div>

        <div class="fc-meta">
          <span id="fc-pos">0 / 0</span>
          <span id="fc-levelmeta"></span>
          <span id="fc-numbermeta"></span>
          <span class="fc-timer" id="fc-timer"></span>
        </div>
      </div>
    `;

    const $ = id => document.getElementById(id);
    const selLevel = $("level-filter");
    const cardEl = $("fc-card");
    const mainEl = $("fc-main");
    const subEl = $("fc-sub");
    const meaningEl = $("fc-meaning");
    const sinoVEl = $("fc-sinoviet");
    const exampleEl = $("fc-example");
    const posEl = $("fc-pos");
    const lvlMetaEl = $("fc-levelmeta");
    const numMetaEl = $("fc-numbermeta");
    const timerEl = $("fc-timer");

    const btnPrev   = $("btn-prev");
    const btnNext   = $("btn-next");
    const btnFlip   = $("btn-flip");
    const btnRandom = $("btn-random");
    const btnPause  = $("btn-pause");

    // Reset timer on these actions only (as requested)
    const onInteract = () => startTimer(true);
    [btnPrev, btnNext, btnFlip, btnRandom, cardEl, selLevel].forEach(el => {
      el.addEventListener("click", onInteract);
      el.addEventListener("change", onInteract);
    });

    btnFlip.onclick   = () => cardEl.classList.toggle("is-back");
    btnNext.onclick   = () => show((idx + 1) % viewData.length);
    btnPrev.onclick   = () => show((idx - 1 + viewData.length) % viewData.length);
    btnRandom.onclick = () => show(pickRandomIndex());
    cardEl.onclick    = () => cardEl.classList.toggle("is-back");

    // Pause / Resume
    let paused = false;
    btnPause.onclick = () => {
      paused = !paused;
      btnPause.textContent = paused ? "Resume" : "Pause";
      if (paused) {
        if (tHandle) clearInterval(tHandle);
        timerEl.textContent = `• Paused (${countdown}s left)`;
      } else {
        // resume without resetting remaining time
        startTimer(false);
      }
    };

    // Keyboard shortcuts
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") { onInteract(); btnNext.click(); }
      if (e.key === "ArrowLeft")  { onInteract(); btnPrev.click(); }
      if (e.key.toLowerCase() === "f") { onInteract(); btnFlip.click(); }
      if (e.code === "Space") { e.preventDefault(); btnPause.click(); }
    });

    let fullData = [];
    let viewData = [];
    let idx = -1, lastIdx = -1;

    // Countdown
    let countdown = 15;
    let tHandle = null;
    function startTimer(reset=false){
      if (tHandle) clearInterval(tHandle);
      if (reset) countdown = 15;

      if (paused) {
        timerEl.textContent = `• Paused (${countdown}s left)`;
        return; // don't run interval while paused
      }

      timerEl.textContent = `• Auto-next in ${countdown}s`;
      tHandle = setInterval(() => {
        countdown--;
        timerEl.textContent = `• Auto-next in ${countdown}s`;
        if (countdown <= 0) {
          clearInterval(tHandle);
          btnNext.click();       // advance
          startTimer(true);      // restart full 15s on the next card
        }
      }, 1000);
    }

    function norm(s){ return (s==null ? "" : String(s)).trim(); }
    function normLevel(s){ return norm(s).replace(/\s+/g, " "); }
    function get(row, key){ return norm(row[FIELDS[key]]); }

    function pickRandomIndex(){
      if (viewData.length <= 1) return 0;
      let i = Math.floor(Math.random() * viewData.length);
      if (i === lastIdx) i = (i + 1) % viewData.length;
      return i;
    }

    // Compose example block:
    //   Chinese (simp → trad → pinyin) → VI example → SinoEx → [blank line] → EN → IPA
    function buildExampleBlock(r){
      const lines = [];
      const simp = get(r, "example_simp");
      const trad = get(r, "example_trad");
      const pin  = get(r, "example_pin");
      const vi   = get(r, "example_vi");
      const sinoEx = get(r, "sino_ex");
      const en   = get(r, "example_en");
      const ipa  = get(r, "example_en_ipa");

      if (simp) lines.push(simp);
      if (trad) lines.push(trad);
      if (pin)  lines.push(pin);
      if (vi)   lines.push(vi, "");
      if (sinoEx) lines.push(sinoEx);

      if ((en || ipa) && lines.length) lines.push("");

      if (en)   lines.push(en);
      if (ipa)  lines.push(ipa);

      return lines.join("\n");
    }

    function show(i){
      if (!viewData.length) return;
      idx = i; lastIdx = i;
      const r = viewData[i];

      const phrase = get(r, "phrase");
      const pinyin = get(r, "pinyin");
      const vnDef  = get(r, "vn_def");
      const sinoV  = get(r, "sino_viet");
      const level  = normLevel(r[FIELDS.level]);
      const number = get(r, "number");

      // Front
      mainEl.textContent = phrase || "—";
      subEl.textContent  = pinyin;

      // Back
      meaningEl.textContent  = vnDef || "";
      sinoVEl.textContent    = sinoV || "";
      exampleEl.textContent  = buildExampleBlock(r);

      // Meta
      posEl.textContent = `${i + 1} / ${viewData.length}`;
      lvlMetaEl.textContent = level ? `• ${level}` : "";
      numMetaEl.textContent = number ? `• #${number}` : "";

      cardEl.classList.remove("is-back");
      startTimer(true);
    }

    async function loadXlsx(url){
      const buf = await fetch(url, { cache:"no-store" }).then(r => {
        if (!r.ok) throw new Error("Failed to fetch Excel file");
        return r.arrayBuffer();
      });
      const wb = XLSX.read(buf, { type:"array" });
      const sheet = wb.Sheets[wb.SheetNames[0]];
      return XLSX.utils.sheet_to_json(sheet, { defval:"" });
    }

    function populateLevels(rows){
      rows.forEach(r => r.__Level = normLevel(r[FIELDS.level]));
      const levels = Array.from(new Set(rows.map(r => r.__Level).filter(Boolean))).sort((a,b)=>a.localeCompare(b,'vi'));
      selLevel.innerHTML = `<option value="__all__">All Levels</option>` + levels.map(l => `<option>${l}</option>`).join("");
      selLevel.onchange = () => applyFilter(selLevel.value);
    }

    function applyFilter(levelVal){
      viewData = (levelVal === "__all__") ? fullData.slice() : fullData.filter(r => r.__Level === levelVal);
      if (!viewData.length) {
        mainEl.textContent = "—"; subEl.textContent = ""; meaningEl.textContent = ""; sinoVEl.textContent = ""; exampleEl.textContent = "";
        posEl.textContent = "0 / 0"; lvlMetaEl.textContent = ""; numMetaEl.textContent = ""; timerEl.textContent = "";
        return;
      }
      show(pickRandomIndex());
    }

    (async () => {
      try {
        fullData = await loadXlsx(XLSX_URL);
      } catch (e) {
        console.error(e);
        fullData = [
          { "Level":"Toàn bộ 150 từ vựng HSK 1", "Number":1, "Phrase":"我", "Pinyin":"wǒ", "Example":"我爱学习。", "Ex-vi":"Tôi yêu học tập.", "VnDef":"Tôi", "Ex-TW":"我愛學習。", "ExPinyin":"wǒ ài xué xí.", "Ex-En":"I love learning.", "Ex-EnIPA":"/aɪ ləv ˈlərnɪŋ./", "SinoEx":"NGÃ ÁI HỌC TẬP.", "SinoViet":"NGÃ" }
        ];
      }
      populateLevels(fullData);
      applyFilter("__all__");
    })();
  })();
  </script>
</body>
</html>
